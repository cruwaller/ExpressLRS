#pragma once

#include <stdint.h>
#include <stddef.h>
#include "gpio.h"
#include "FIFO.h"

#define SERIAL_8N1 0x06

/* Interface kept arduino compatible */
class HardwareSerial
{
public:
    HardwareSerial(uint32_t rx, uint32_t tx);
    HardwareSerial(void *peripheral);
    void begin(unsigned long baud, uint8_t mode = SERIAL_8N1);
    void end(void);
    virtual int available(void);
    virtual int peek(void);
    virtual int read(void);
    virtual void flush(void);
    virtual uint32_t write(uint8_t);
    virtual uint32_t write(const uint8_t *buff, uint32_t len);

#if TX_MODULE
    void EnableReceiver(void);
    void EnableTransmitter(void);
#endif

protected:
    void* p_serial;
    uint32_t rx_pin;
    uint32_t tx_pin;
    int32_t irq;
#if TX_MODULE
    struct gpio_out p_duplex_pin;
#endif
    FIFO input;
    FIFO output;
};
